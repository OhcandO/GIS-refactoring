var _baseCMV,_select_layer_index,_n_tolerance,_n_snap_mode,edit_obj_layer_list,_EditDrawingStart,_EditDrawingEnd,_EditDrawingCommit,_EditDrawingCancel,_EditDrawingMove,_EditCreated,_EditDragStart,_EditDrag,_EditDragEnd,_EditVertexDeleted,_EditVertexDrag,_EditVertexDragStart,_EditVertexDragEnd;function _DragEnd(c2b){if(_EditDragEnd!=null)_EditDragEnd(c2b);}_baseCMV=null;function _DrawingCommit(B2b){if(_EditDrawingCommit!=null){B2b["layer"]["cmv_id"]=-1;_EditDrawingCommit(B2b);}}_select_layer_index=-1;function _DrawingMove(C2b){if(_EditDrawingMove!=null)_EditDrawingMove(C2b);}function _VertexDragStart(k2b){if(_EditVertexDragStart!=null)_EditVertexDragStart(k2b);}_n_tolerance=10;_n_snap_mode=0;function _DragStart(q2b){if(_EditDragStart!=null)_EditDragStart(q2b);}edit_obj_layer_list=[];function _DrawingStart(z1m){if(_EditDrawingStart!=null)_EditDrawingStart(z1m);}function _VertexDragEnd(y2b){if(_EditVertexDragEnd!=null)_EditVertexDragEnd(y2b);}_EditDrawingStart=null;function _DrawingCancel(u2b){if(_EditDrawingCancel!=null)_EditDrawingCancel(u2b);}_EditDrawingEnd=null;function _DrawingEnd(Z2b){if(_EditDrawingEnd!=null)_EditDrawingEnd(Z2b);}_EditDrawingCommit=null;function _VertexDrag(r2b){if(_EditVertexDrag!=null)_EditVertexDrag(r2b);}_EditDrawingCancel=null;_EditDrawingMove=null;_EditCreated=null;_EditDragStart=null;_EditDrag=null;_EditDragEnd=null;_EditVertexDeleted=null;_EditVertexDrag=null;_EditVertexDragStart=null;_EditVertexDragEnd=null;L["XEdit"]["CMV"]=L["XEdit"]["extend"]({CME_Callback_DrawingStart:function(F2b){_EditDrawingStart=F2b;},CME_Callback_DrawingEnd:function(A2b){_EditDrawingEnd=A2b;},CME_Callback_DrawingCommit:function(g2b){_EditDrawingCommit=g2b;},CME_Callback_DrawingCancel:function(t2b){_EditDrawingCancel=t2b;},CME_Callback_DrawingMove:function(a2b){_EditDrawingMove=a2b;},CME_Callback_Created:function(e2b){_EditCreated=e2b;},CME_Callback_DragStart:function(V2b){_EditDragStart=V2b;},CME_Callback_Drag:function(j2b){_EditDrag=j2b;},CME_Callback_DragEnd:function(E2b){_EditDragEnd=E2b;},CME_Callback_VertexDeleted:function(z2b){_EditVertexDeleted=z2b;},CME_Callback_VertexDrag:function(m2b){_EditVertexDrag=m2b;},CME_Callback_VertexDragStart:function(p2b){_EditVertexDragStart=p2b;},CME_Callback_VertexDragEnd:function(G2b){_EditVertexDragEnd=G2b;},initialize:function(o2b,b2b){this["init"](o2b);this["set_callback_drawing_start"](_DrawingStart);this["set_callback_drawing_end"](_DrawingEnd);this["set_callback_drawing_commit"](_DrawingCommit);this["set_callback_drawing_cancel"](_DrawingCancel);this["set_callback_drawing_move"](_DrawingMove);this["set_callback_created"](_Created);this["set_callback_drag_start"](_DragStart);this["set_callback_drag"](_Drag);this["set_callback_drag_end"](_DragEnd);this["set_callback_vertex_deleted"](_VertexDeleted);this["set_callback_vertex_drag"](_VertexDrag);this["set_callback_vertex_drag_start"](_VertexDragStart);this["set_callback_vertex_drag_end"](_VertexDragEnd);_baseCMV=b2b;},CME_CreatePoint:function(H2b){if(this["get_edit_enable_status"]()==true){this["create_point"](H2b);}},CME_CreatePolyline:function(){if(this["get_edit_enable_status"]()==true){this["create_polyline"]();}},CME_CreatePolygon:function(){if(this["get_edit_enable_status"]()==true){this["create_polygon"]();}},_CME_AddPoint:function(J2b,Y2b){if(this["get_edit_enable_status"]()==false)return-1;J2b["cmv_id"]=Y2b;J2b["options"]["type"]='IconPoint';return this["add_point"](J2b);},CME_AddPoint_PT:function(X2b,S2b,D2b){var l2b,x2b;if(this["get_edit_enable_status"]()==false)return-1;l2b=L["marker"]([X2b["lat"],X2b["lng"]]);x2b=this["_CME_AddPoint"](l2b,S2b);if(x2b!=-1){if(D2b=='CA'){_baseCMV["addDisableObjList"](S2b);this["select_object"](x2b);this["CME_SetUndoRedoData"](D2b,l2b,S2b);}else{this["CME_SetUndoRedoData"]('A',l2b,S2b);}}return x2b;},_CME_AddPolyline:function(d2b,K2b){if(this["get_edit_enable_status"]()==false)return-1;d2b["cmv_id"]=K2b;d2b["options"]["type"]='Line';return this["add_polyline"](d2b);},CME_AddPolyline_PTS:function(P2b,L2b,n2b){var O2b,R2b;if(this["get_edit_enable_status"]()==false)return-1;O2b=L["polyline"](P2b,{draggable:true,pane:'markerPane'});R2b=this["_CME_AddPolyline"](O2b,L2b);if(R2b!=-1){if(n2b=='CA'){_baseCMV["addDisableObjList"](L2b);this["select_object"](R2b);this["CME_SetUndoRedoData"](n2b,O2b,L2b);}else{this["CME_SetUndoRedoData"]('A',O2b,L2b);}}return R2b;},_CME_AddPolygon:function(w2b,h2b){if(this["get_edit_enable_status"]()==false)return-1;w2b["cmv_id"]=h2b;w2b["options"]["type"]='Polygon';return this["add_polygon"](w2b);},CME_AddPolygon_PTS:function(W2b,i2b,Q2b){var s2b,U2b;if(this["get_edit_enable_status"]()==false)return-1;s2b=L["polygon"](W2b,{draggable:true,pane:'markerPane'});U2b=this["_CME_AddPolygon"](s2b,i2b);if(U2b!=-1){if(Q2b=='CA'){_baseCMV["addDisableObjList"](i2b);this["select_object"](U2b);this["CME_SetUndoRedoData"](Q2b,s2b,i2b);}else{this["CME_SetUndoRedoData"]('A',s2b,i2b);}}return U2b;},CME_StopDrawing:function(){if(this["get_edit_enable_status"]()==true)this["stop_drawing"]();},CME_CommitDrawing:function(){if(this["get_edit_enable_status"]()==true)this["commit_drawing"]();},CME_Start:function(){this["start"]();this["clear_edit_obj_list"]();this["clear_select_obj_list"]();_baseCMV["clearDisableObjList"]();edit_obj_layer_list["length"]=0;},CME_End:function(){var T2b,Z7b,f2b;T2b=this["get_edit_obj_count"]();for(var N2b=0;N2b<T2b;N2b++){Z7b=this["get_edit_obj_id"](N2b);f2b=this["get_object"](Z7b);if(f2b!=null)_baseMap["removeLayer"](f2b);}_baseCMV["clearDisableObjList"]();this["end"]();this["clear_edit_obj_list"]();this["clear_select_obj_list"]();_baseCMV["clearDisableObjList"]();edit_obj_layer_list["length"]=0;},CME_SelectEditLayer:function(B7b){this["set_edit_layer_index"](B7b);_select_layer_index=B7b;},CME_SetTolerance:function(u7b){_n_tolerance=u7b;},CME_SetSnap:function(C7b){if(C7b!=1)C7b=0;_n_snap_mode=C7b;},CME_SetEditMode:function(v7b){if(this["get_edit_enable_status"]()==true)this["set_edit_mode"](v7b);},CME_GetEditMode:function(){return this["get_edit_mode"]();},CME_GetEditObjectCount:function(){return this["get_edit_obj_count"]();},CME_GetEditObjectInfo:function(q7b){return this["get_edit_obj"](q7b);},CME_GetEditObjectID:function(M7b){return this["get_edit_obj_id"](M7b);},CME_GetEditObjectLayerIbdex:function(c7b){return this["get_edit_obj_layer_index"](c7b);},CME_GetSelectObjectCount:function(){return this["get_edit_select_obj_count"]();},CME_GetSelectObjectID:function(I7b){return this["get_select_obj_id"](I7b);},CME_GetDeleteObjectCount:function(){return this["get_delete_obj_count"]();},CME_GetDeleteObjectInfo:function(r7b){return this["get_delete_obj"](r7b);},CME_GetObject:function(y7b){var k7b;k7b=this["get_object"](y7b);return k7b;},CME_DeleteObject:function(g7b){var F7b,A7b,a7b,e7b;F7b=null;for(var t7b in _baseMap["_layers"]){A7b=_baseMap["_layers"][t7b];if(A7b["obj_id"]==undefined)continue;if(A7b["obj_id"]==g7b){F7b=A7b;break;}}if(F7b==null){console["log"]("[CME_DeleteObject] ly is null");return;}this["CME_SetUndoRedoData"]('D',F7b,F7b["cmv_id"]);a7b=this["_DeleteObject"](g7b,F7b["cmv_id"]);if(a7b==-1){e7b=this["pop_undo_data"]();return;}this["delete_select_object"](g7b);},CME_SelectObject:function(E7b){var V7b,j7b;V7b=this["select_object"](E7b);if(V7b!=-1){j7b=this["get_object"](V7b);if(j7b==null)return-1;this["CME_SetUndoRedoData"]('S',j7b,j7b["cmv_id"]);}return V7b;},CME_SelectObject_PT:function(p7b){var z7b,m7b;z7b=this["select_object_pt"](p7b);if(z7b!=-1){m7b=this["get_object"](z7b);if(m7b==null)return-1;this["CME_SetUndoRedoData"]('S',m7b,m7b["cmv_id"]);}return z7b;},CME_SelectObjectStatus:function(b7b){var G7b,o7b;G7b=this["get_select_obj_id"](0);if(G7b>-1){o7b=this["get_object"](G7b);if(b7b==true)this["set_object_status"](o7b,true);else this["set_object_status"](o7b,false);}},CME_SelectObjectStatus_All:function(H7b){if(H7b==true)this["set_object_status_all_select"](true);else this["set_object_status_all_select"](false);},CME_GetCmvObject_PT:function(x7b){var J7b,l7b,S7b;if(_select_layer_index==-1)return null;if(_baseCMV==undefined||!_baseCMV)return null;J7b=null;l7b=_baseMap["options"]["crs"]["project"](x7b);for(var Y7b=0;Y7b<_baseCMV["cmTiles"]["length"];Y7b++){S7b=_baseCMV["cmTiles"][Y7b];S7b["setToleranceUnit"](0);J7b=S7b["getSelectedObject_LayerIndex"](_select_layer_index,l7b,_n_tolerance,_baseMap["getZoom"]());if(J7b)break;}return J7b;},CME_GetSnapPos:function(Q7b){var n7b,d7b,f7b,Z5b,i7b,u5b,R7b,P7b,U7b,X7b,s7b,W7b,N7b,C5b,K7b,B5b,T7b,w7b,O7b,q5b,v5b;if(_select_layer_index==-1)return null;if(_baseCMV==undefined||!_baseCMV)return null;if(_n_snap_mode==0)return null;n7b=null;d7b=null;f7b=Number["MAX_VALUE"];Z5b=Number["MAX_VALUE"];i7b=Number["MAX_VALUE"];u5b=_n_tolerance*this["_GetDistancePerPixel"](_baseMap["getZoom"]());R7b=_baseMap["options"]["crs"]["project"](Q7b);P7b=null;for(var L7b=0;L7b<_baseCMV["cmTiles"]["length"];L7b++){U7b=_baseCMV["cmTiles"][L7b];U7b["setToleranceUnit"](0);P7b=U7b["getObjects_SnapPoint"](R7b,_n_tolerance);if(P7b["length"]>0){for(var h7b=0;h7b<P7b["length"];h7b++){X7b=U7b["getObjectDistance"](P7b[h7b],R7b);if(X7b<=f7b){f7b=X7b;d7b=P7b[h7b];}}break;}}if(d7b!=null){if(!d7b["Points"]["length"]){n7b=_baseMap["options"]["crs"]["unproject"](d7b["PositionGeo"]);}else{s7b=d7b["Points"]["length"]-1;for(var D7b=0;D7b<=s7b;D7b++){W7b=d7b["Points"][D7b]["x"]-R7b["x"];N7b=d7b["Points"][D7b]["y"]-R7b["y"];X7b=Math["sqrt"](W7b*W7b+N7b*N7b);if(X7b<=i7b){if(X7b<u5b){i7b=X7b;n7b=_baseMap["options"]["crs"]["unproject"](d7b["Points"][D7b]);}}}}}C5b=this["get_select_obj_id"](0);K7b=null;B5b=this["get_edit_obj_count"]();for(var L7b=0;L7b<B5b;L7b++){T7b=this["get_edit_obj_id"](L7b);if(C5b==T7b)continue;O7b=this["get_object"](T7b);if(O7b["options"]["type"]=='IconPoint'){q5b=GA_WGS84ToUTMK_Pt(_baseMap,O7b["_latlng"]);w7b=new Array();w7b["push"](q5b);}else{w7b=GA_WGS84ToUTMK_Pts(_baseMap,O7b["_latlngs"]);}v5b=GA_IsNearObject(w7b,R7b,_n_tolerance);if(v5b==true){if(O7b["options"]["type"]=='IconPoint'||O7b["options"]["type"]=='Line'||O7b["options"]["type"]=='Polygon'){X7b=GA_GetObjDistance(w7b,R7b);if(X7b<=Z5b){Z5b=X7b;K7b=O7b;}}}}if(K7b!=null){if(K7b["options"]["type"]=='IconPoint'){n7b=K7b["_latlng"];}else{s7b=K7b["_latlngs"]["length"]-1;for(var D7b=0;D7b<=s7b;D7b++){X7b=GA_GetDistance_WGS84(K7b["_latlngs"][D7b]["lng"],K7b["_latlngs"][D7b]["lat"],Q7b["lng"],Q7b["lat"],"m");if(X7b<=i7b){i7b=X7b;n7b=K7b["_latlngs"][D7b];}}}}return n7b;},CME_SetUndoRedoData:function(a5b,M5b,e5b){var F5b,I5b,r5b,k5b,y5b,t5b,g5b,A5b;F5b=this["get_undo_data"]();if(F5b!=null){if(F5b["Status"]==a5b&&F5b["OBJ_ID"]==M5b["obj_id"])return;}I5b=new URInfo();I5b["Status"]=a5b;I5b["Type"]=M5b["options"]["type"];I5b["OBJ_ID"]=M5b["obj_id"];I5b["CMV_ID"]=e5b;I5b["Points"]=new Array();if(M5b["options"]["type"]=='IconPoint'){r5b=M5b["_latlng"]["lng"];k5b=M5b["_latlng"]["lat"];y5b=new EPoint(r5b,k5b);I5b["Points"]["push"](y5b);}else if(M5b["options"]["type"]=='Line'){for(var c5b=0;c5b<M5b["getLatLngs"]()["length"];c5b++){r5b=M5b["_latlngs"][c5b]["lng"];k5b=M5b["_latlngs"][c5b]["lat"];y5b=new EPoint(r5b,k5b);I5b["Points"]["push"](y5b);}}else if(M5b["options"]["type"]=='Polygon'){t5b=M5b["getLatLngs"]();g5b=0;for(var c5b=0;c5b<t5b[g5b]["length"];c5b++){A5b=t5b[g5b];r5b=A5b[c5b]["lng"];k5b=A5b[c5b]["lat"];y5b=new EPoint(r5b,k5b);I5b["Points"]["push"](y5b);}}this["set_undo_redo_data"](I5b);},CME_Undo:function(){var V5b,j5b,z5b,E5b;if(this["get_edit_enable_status"]()==false)return-1;if(this["get_undo_redo_max_count"]()==this["get_undo_redo_cur_pos"]()+1&&this["get_select_obj_id"](0)>-1)this["set_undo_redo_cur_pos"](-1);this["set_object_status_all_select"](false);V5b=this["pop_undo_data"]();if(V5b==null)return-1;if(V5b["Status"]=='C'||V5b["Status"]=='A'){this["delete_object"](V5b["OBJ_ID"]);this["delete_select_object"](V5b["OBJ_ID"]);}else if(V5b["Status"]=='S'){j5b=this["get_object"](V5b["OBJ_ID"]);if(V5b["Type"]=='IconPoint')j5b["setLatLng"]([V5b["Points"][0]["lat"],V5b["Points"][0]["lng"]]);else j5b["setLatLngs"](V5b["Points"]);this["select_object"](V5b["OBJ_ID"]);}else if(V5b["Status"]=='CA'){j5b=this["get_object"](V5b["OBJ_ID"]);if(V5b["Type"]=='IconPoint')j5b["setLatLng"]([V5b["Points"][0]["lat"],V5b["Points"][0]["lng"]]);else j5b["setLatLngs"](V5b["Points"]);this["select_object"](V5b["OBJ_ID"]);}else if(V5b["Status"]=='D'){z5b=V5b["Points"];if(V5b["Type"]=='IconPoint'){E5b=L["marker"]([z5b[0]["lat"],z5b[0]["lng"]]);E5b["obj_id"]=V5b["OBJ_ID"];this["_CME_AddPoint"](E5b,V5b["CMV_ID"]);}else if(V5b["Type"]=='Line'){E5b=L["polyline"](z5b,{draggable:true,pane:'markerPane'});E5b["obj_id"]=V5b["OBJ_ID"];this["_CME_AddPolyline"](E5b,V5b["CMV_ID"]);}else if(V5b["Type"]=='Polygon'){E5b=L["polygon"](z5b,{draggable:true,pane:'markerPane'});E5b["obj_id"]=V5b["OBJ_ID"];this["_CME_AddPolygon"](E5b,V5b["CMV_ID"]);}}else if(V5b["Status"]=='M'){j5b=this["get_object"](V5b["OBJ_ID"]);if(V5b["Type"]=='IconPoint')j5b["setLatLng"](V5b["Points"][0]);else j5b["setLatLngs"](V5b["Points"]);this["select_object"](V5b["OBJ_ID"]);}else if(V5b["Status"]=='V'){j5b=this["get_object"](V5b["OBJ_ID"]);j5b["setLatLngs"](V5b["Points"]);this["select_object"](V5b["OBJ_ID"]);}return 1;},CME_Redo:function(){var m5b,o5b,G5b,p5b;if(this["get_edit_enable_status"]()==false)return-1;if(this["get_redo_data"]()!=null)this["set_object_status_all_select"](false);m5b=this["pop_redo_data"]();if(m5b==null)return-1;if(m5b["Status"]=='C'||m5b["Status"]=='A'){o5b=m5b["Points"];if(m5b["Type"]=='IconPoint'){G5b=L["marker"]([o5b[0]["lat"],o5b[0]["lng"]]);G5b["obj_id"]=m5b["OBJ_ID"];this["_CME_AddPoint"](G5b,m5b["CMV_ID"]);}else if(m5b["Type"]=='Line'){G5b=L["polyline"](o5b,{draggable:true,pane:'markerPane'});G5b["obj_id"]=m5b["OBJ_ID"];this["_CME_AddPolyline"](G5b,m5b["CMV_ID"]);}else if(m5b["Type"]=='Polygon'){G5b=L["polygon"](o5b,{draggable:true,pane:'markerPane'});G5b["obj_id"]=m5b["OBJ_ID"];this["_CME_AddPolygon"](G5b,m5b["CMV_ID"]);}}else if(m5b["Status"]=='S'){p5b=this["get_object"](m5b["OBJ_ID"]);if(m5b["Type"]=='IconPoint')p5b["setLatLng"]([m5b["Points"][0]["lat"],m5b["Points"][0]["lng"]]);else p5b["setLatLngs"](m5b["Points"]);this["select_object"](m5b["OBJ_ID"]);}else if(m5b["Status"]=='CA'){p5b=this["get_object"](m5b["OBJ_ID"]);if(m5b["Type"]=='IconPoint')p5b["setLatLng"]([m5b["Points"][0]["lat"],m5b["Points"][0]["lng"]]);else p5b["setLatLngs"](m5b["Points"]);this["select_object"](m5b["OBJ_ID"]);}else if(m5b["Status"]=='D'){this["delete_object"](m5b["OBJ_ID"]);this["delete_select_object"](m5b["OBJ_ID"]);}else if(m5b["Status"]=='M'){p5b=this["get_object"](m5b["OBJ_ID"]);if(m5b["Type"]=='IconPoint')p5b["setLatLng"](m5b["Points"][0]);else p5b["setLatLngs"](m5b["Points"]);this["select_object"](m5b["OBJ_ID"]);}else if(m5b["Status"]=='V'){p5b=this["get_object"](m5b["OBJ_ID"]);p5b["setLatLngs"](m5b["Points"]);this["select_object"](m5b["OBJ_ID"]);}return 1;},_DeleteObject:function(Y5b,H5b){var b5b,J5b,S5b;b5b=-1;if(H5b!=-1&&H5b!=undefined){J5b=this["delete_object"](Y5b,true);S5b=this["get_delete_obj"](J5b);S5b["cmv_id"]=H5b;b5b=J5b;}else{b5b=this["delete_object"](Y5b);}return b5b;},_GetDistancePerPixel:function(X5b){var l5b;l5b=125094.2329;for(var x5b=0;x5b<X5b;x5b++){l5b=l5b/2;}return l5b;}});function _Created(v2b){if(_EditCreated!=null)_EditCreated(v2b);}function _Drag(M2b){if(_EditDrag!=null)_EditDrag(M2b);}function _VertexDeleted(I2b){if(_EditVertexDeletedt!=null)_EditVertexDeleted(I2b);}L["xedit"]["cmv"]=function(){return new L["XEdit"]["CMV"]();};