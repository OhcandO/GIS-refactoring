<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: classes/abstract/MO.Publisher.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: classes/abstract/MO.Publisher.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { MOSubscriber } from "./MO.Subscriber.js";

/**
 * MOPublisher Îäî MOSubscriber Îì§ÏùÑ Îì±Î°ùÌïòÍ≥†
 * Îì±Î°ùÎêú Íµ¨ÎèÖÏûêÏóêÍ≤å ÏïåÎ¶ºÏùÑ Î≥¥ÎÉÑ (notify)
 * 
 * @author jhoh
 */
export class MOPublisher {
    /** Í≥†Ïú† ÏãùÎ≥ÑÏûê
     *  @type {Symbol}*/
    #subjectId;
    /** Ïù∏ÏßÄÍ∞ÄÎä•Ìïú Publisher Ïù¥Î¶Ñ
     * @type {string}*/
    NAME;
    /** Îì±Î°ùÎê† ÏòµÏ†ÄÎ≤Ñ Í∞ùÏ≤¥Ïùò name Ïù¥ keyÎ°ú, ÏòµÏ†ÄÎ≤Ñ Í∞ùÏ≤¥Í∞Ä value Î°ú Îì±Î°ù*/
    #observerListObj = {
        DEFAULT: [],
    };

    /**
     * Creates an instance of MOSubject.
     * @param {String} Ïù¥ ÌçºÎ∏îÎ¶¨ÏÖîÏùò Ïù¥Î¶Ñ
     */
    constructor(name) {
        this.#subjectId = Symbol();
        name ? (this.NAME = name) : (this.NAME = `MOPublisher_${new Date().getTime()}`);
    }

    //‚¨ú‚¨ú‚¨úÏ†ëÍ∑ºÍ∞ÄÎä•Ìïú Î©îÏÑúÎìú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú

    /**
     * Ïù¥ Publisher Í∞ùÏ≤¥Ïùò Í≥†Ïú† ÏãùÎ≥ÑÏûê Î∞òÌôò
     * @returns {symbol}
     * @readonly
     * @memberof MOPublisher
     */
    get id() {
        return this.#subjectId;
    }

    /**
     * ÏòµÏ†ÄÎ≤Ñ Í∞ùÏ≤¥ Îì±Î°ù
     * @param {MOSubscriber} subscriber - ÏòµÏ†ÄÎ≤Ñ Í∞ùÏ≤¥
     * @param {string} [groupName] - Í∑∏Î£πÏù¥Î¶Ñ
     */
    regist(subscriber, groupName = "DEFAULT") {
        if (!this.isSubscriberHere(subscriber)) {
            this.#push2ObsList(subscriber, groupName);
            if(!subscriber.isPublisherHere(this)) subscriber.regist(this);
//            console.log(`üü†Ïã†Í∑ú ÏòµÏ†ÄÎ≤Ñ Íµ¨ÎèÖÏãúÏûë‚úÖ : ${subscriber.NAME}`);
        } else {
            // console.log(`ÏòµÏ†ÄÎ≤Ñ Ïù¥ÎØ∏ Îì±Î°ùÎê®`);
        }
    }
    /**
     * ÏòµÏ†ÄÎ≤ÑÎ•º Íµ¨ÎèÖÏûê Î¶¨Ïä§Ìä∏ÏóêÏÑú Ï†úÍ±∞
     * @param {MOSubscriber} subscriber
     */
    unregist(subscriber) {
        if (subscriber instanceof MOSubscriber) {
            if (this.isSubscriberHere(subscriber)) {
                subscriber.unregist(this);
                this.#filterExceptThis(subscriber);
                console.log(`üü† ÏòµÏ†ÄÎ≤Ñ Íµ¨ÎèÖÌï¥Ï†ú‚õî`);
            } else {
                // console.log(`Îì±Î°ùÎêú ÏòµÏ†ÄÎ≤Ñ ÏïÑÎãàÎùº ÏßÄÏö∞ÏßÄ ÏïäÏùå @deleteObserver `,observer);
            }
        }
    }

    /**
     * Ïù¥ Observer Í∞ùÏ≤¥Í∞Ä Îì±Î°ùÎêú Subject Î¶¨Ïä§Ìä∏ Ï∂úÎ†•
     */
    showSubscribersList() {
        console.group(`${this.NAME} Ïùò Subscriber Î¶¨Ïä§Ìä∏`);
        console.table(this.#observerListObj);
        console.groupEnd();
        //return this.#observerObj;
    }

     /**
     * Ïù¥ PublisherÏóê Îì±Î°ùÎêú Subscriber Îì§ÏóêÍ≤å ÏïåÎ¶º Î≥¥ÎÉÑ
     * @returns {Promise} promise chaining
     */
     notify(groupName = "DEFAULT") {
        let tempObsArr;
        try {
            tempObsArr = this.#getSubscriberList(groupName);
            tempObsArr.forEach((obsrv) => obsrv.update(this.id));
            return Promise.resolve(`ÏïåÎûåÏàòÌñâ`);
        } catch (noObsError) {
            return Promise.reject(noObsError);
        }
    }
//‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú‚¨ú

//üü®üü®üü®Absract methodüü®üü®üü®üü®üü®üü®üü®üü®üü®
    /**
     * (Ï∂îÏÉÅ GET Î©îÏÑúÎìú)
     * @abstract
     * @type {Array}
     * @memberof MOSubject
     */
    get PublisherData() {
        throw new Error(`implement required`);
    }

   
//üü®üü®üü®üü®üü®üü®üü®üü®üü®üü®üü®üü®


//‚¨õ‚¨õ‚¨õ‚¨õüö´ Private methods‚¨õ‚¨õ‚¨õ‚¨õ‚¨õ‚¨õ‚¨õ‚¨õ‚¨õ‚¨õ‚¨õ‚¨õ
    #push2ObsList(subscriber, groupName) {
        if (groupName) {
            if (!this.#observerListObj[groupName] instanceof Array)
                this.#observerListObj[groupName] = [];
            if (!this.isSubscriberHere(subscriber))
                this.#observerListObj[groupName].push(subscriber);
        } else {
            this.#observerListObj["DEFAULT"].push(subscriber);
        }
    }

    #filterExceptThis(observer) {
        if (this.isSubscriberHere(observer)) {
            this.#observerListObj = Object.fromEntries(
                Object.entries(this.#observerListObj).map(([k, v]) => [
                    k,
                    v.filter((el) => el.id != observer.id),
                ])
            );
        }
    }

    /**
     * Observer Í∞ùÏ≤¥ Ïó¨Í∏∞ ÏûàÎÇòÏöî?
     * @param {MOSubscriber} subscriber Ï°¥Ïû¨Ïó¨Î∂Ä ÌåêÎã®Ìï† Observer Í∞ùÏ≤¥
     * @returns {boolean} Subject Í∞ùÏ≤¥Ïóê Ìï¥Îãπ Observer Í∞Ä Îì±Î°ùÎêòÏñ¥ ÏûàÎäîÏßÄ Ïó¨Î∂Ä
     */
    isSubscriberHere(subscriber) {
        let bool = false;
        if (subscriber instanceof MOSubscriber) {
            bool = this.#getSubscriberList().some((el) => el.id === subscriber.id);
        }
        return bool;
    }

    /**
     * Ïù¥ SubjectÏóê Îì±Î°ùÎêú Î™®Îì† MObserver Î∞∞Ïó¥ Î∞òÌôò
     * @returns {MOSubscriber} MObserver Î∞∞Ïó¥
     */
    #getSubscriberList(groupName) {
        const tempArr = groupName
            ? this.#observerListObj[groupName]
            : Object.values(this.#observerListObj["DEFAULT"]);
        // if (tempArr instanceof Array &amp;&amp; tempArr.length > 0) {
            return [...new Set(tempArr.flat())]; //&lt;-- ÍπäÏùÄ Î≥µÏÇ¨
        // } else {
        //     throw new Error(`Ï°∞Í±¥Ïóê ÎßûÎäî MOobserver ÏóÜÏùå :${groupName}`);
        // }
    }

//‚¨õ‚¨õ‚¨õ‚¨õ‚¨õ‚¨õ‚¨õ‚¨õ‚¨õ‚¨õ‚¨õ‚¨õ‚¨õ‚¨õ‚¨õ‚¨õ
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-ol_Overlay.html">ol/Overlay</a></li></ul><h3>Classes</h3><ul><li><a href="LayerFactory.html">LayerFactory</a></li><li><a href="LayerFactory.exports.LayerFactory.html">exports.LayerFactory</a></li><li><a href="LayerTree.html">LayerTree</a></li><li><a href="LayerTree_LayerTree.html">LayerTree</a></li><li><a href="LayerTree_new.html">LayerTree_new</a></li><li><a href="LayerTree_new_LayerTree.html">LayerTree</a></li><li><a href="MOFactory.html">MOFactory</a></li><li><a href="MOGISMap.html">MOGISMap</a></li><li><a href="MOGISMap_MOGISMap.html">MOGISMap</a></li><li><a href="MOLegend.html">MOLegend</a></li><li><a href="MOLegend_MOLegend.html">MOLegend</a></li><li><a href="MOMeasure.html">MOMeasure</a></li><li><a href="MOPagin.html">MOPagin</a></li><li><a href="MOPagin_MOPagin.html">MOPagin</a></li><li><a href="MOPublisher.html">MOPublisher</a></li><li><a href="MOSimpleMap.html">MOSimpleMap</a></li><li><a href="MOSourceConfig.html">MOSourceConfig</a></li><li><a href="MOSubscriber.html">MOSubscriber</a></li><li><a href="MapViewKit.html">MapViewKit</a></li><li><a href="SourceFactory.exports.SourceFactory.html">exports.SourceFactory</a></li><li><a href="SourceFactoryIntra.html">SourceFactoryIntra</a></li><li><a href="StyleFactory.html">StyleFactory</a></li><li><a href="TileLoadProgress.html">TileLoadProgress</a></li><li><a href="module-ol_Overlay.MOOverlay.html">MOOverlay</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ADDRESS_SOURCE_LAYER_KEY">ADDRESS_SOURCE_LAYER_KEY</a></li><li><a href="global.html#ARC_LAYER_ID">ARC_LAYER_ID</a></li><li><a href="global.html#CHILD_MARK">CHILD_MARK</a></li><li><a href="global.html#HIGHLIGHT_SOURCE_LAYER_KEY">HIGHLIGHT_SOURCE_LAYER_KEY</a></li><li><a href="global.html#LAYER_ID">LAYER_ID</a></li><li><a href="global.html#LAYER_NAME">LAYER_NAME</a></li><li><a href="global.html#LAYER_PURPOSE_CATEGORY">LAYER_PURPOSE_CATEGORY</a></li><li><a href="global.html#MAP">MAP</a></li><li><a href="global.html#OL_GEOMETRY_OBJ">OL_GEOMETRY_OBJ</a></li><li><a href="global.html#PARENT_ID">PARENT_ID</a></li><li><a href="global.html#POLYGON_SELECT_MARGINAL_RESOLUTION">POLYGON_SELECT_MARGINAL_RESOLUTION</a></li><li><a href="global.html#SOURCE_CATEGORY">SOURCE_CATEGORY</a></li><li><a href="global.html#SOURCE_CLASS">SOURCE_CLASS</a></li><li><a href="global.html#TYPE_NAME">TYPE_NAME</a></li><li><a href="global.html#VIEW">VIEW</a></li><li><a href="global.html#VIRTUAL_SOURCE_LAYER_KEY">VIRTUAL_SOURCE_LAYER_KEY</a></li><li><a href="global.html#base">base</a></li><li><a href="global.html#closeSearchModal">closeSearchModal</a></li><li><a href="global.html#comp">comp</a></li><li><a href="global.html#createStyleFunction">createStyleFunction</a></li><li><a href="global.html#createStyleFunctionForScale">createStyleFunctionForScale</a></li><li><a href="global.html#default">default</a></li><li><a href="global.html#default_spec">default_spec</a></li><li><a href="global.html#depthTabsAddress">depthTabsAddress</a></li><li><a href="global.html#getLayerCode">getLayerCode</a></li><li><a href="global.html#getLayerType">getLayerType</a></li><li><a href="global.html#getStyleFunc_POINT">getStyleFunc_POINT</a></li><li><a href="global.html#getTextStyle">getTextStyle</a></li><li><a href="global.html#getUpdatedLayerCode">getUpdatedLayerCode</a></li><li><a href="global.html#gisSearch">gisSearch</a></li><li><a href="global.html#iconPath">iconPath</a></li><li><a href="global.html#id">id</a></li><li><a href="global.html#isNumeric">isNumeric</a></li><li><a href="global.html#jsonNestor">jsonNestor</a></li><li><a href="global.html#layer">layer</a></li><li><a href="global.html#leak">leak</a></li><li><a href="global.html#manage">manage</a></li><li><a href="global.html#mapModifier">mapModifier</a></li><li><a href="global.html#mergeMaps">mergeMaps</a></li><li><a href="global.html#mgcInform">mgcInform</a></li><li><a href="global.html#pipenet">pipenet</a></li><li><a href="global.html#portable">portable</a></li><li><a href="global.html#projection">projection</a></li><li><a href="global.html#public">public</a></li><li><a href="global.html#realtime">realtime</a></li><li><a href="global.html#risk">risk</a></li><li><a href="global.html#searchFeature">searchFeature</a></li><li><a href="global.html#source">source</a></li><li><a href="global.html#target">target</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Wed Feb 21 2024 20:55:10 GMT+0900 (ÎåÄÌïúÎØºÍµ≠ ÌëúÏ§ÄÏãú)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
